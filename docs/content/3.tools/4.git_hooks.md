---
title: Git Hooks
description: Enforce code quality and validate commits with TypeScript-based ZX hooks.
navigation:
  icon: i-heroicons-command-line
layout: default
---

We use TypeScript-based ZX hooks to enforce code quality and validate commits.

## Available Hooks

### `pre-commit` ([pre-commit.ts](https://github.com/TerrorSquad/php-booster/blob/main/booster/.husky/pre-commit.ts))

Runs quality tools on staged files (PHP Syntax, Rector, ECS, PHPStan, Psalm, etc.).

**Environment Variables:**

::field-group
  ::field{name="SKIP_PRECOMMIT" type="boolean"}
  Skip entire hook
  ::
  ::field{name="SKIP_RECTOR" type="boolean"}
  Skip Rector checks
  ::
  ::field{name="SKIP_ECS" type="boolean"}
  Skip ECS checks
  ::
  ::field{name="GIT_HOOKS_VERBOSE" type="boolean"}
  Enable verbose logging
  ::
  ::field{name="HOOKS_ONLY" type="string"}
  Run only specific tool groups (comma-separated: `lint`, `format`, `analysis`, `refactor`)
  ::
::

### `pre-push` ([pre-push.ts](https://github.com/TerrorSquad/php-booster/blob/main/booster/.husky/pre-push.ts))

Runs Pest tests (blocking) and generates artifacts (non-blocking) before pushing.

**Environment Variables:**

::field-group
  ::field{name="SKIP_PREPUSH" type="boolean"}
  Skip entire hook
  ::
  ::field{name="SKIP_API_DOCS" type="boolean"}
  Skip API documentation generation
  ::
  ::field{name="SKIP_DEPTRAC_IMAGE" type="boolean"}
  Skip Deptrac architecture diagram generation
  ::
  ::field{name="GIT_HOOKS_VERBOSE" type="boolean"}
  Enable verbose logging
  ::
::

### `commit-msg` ([commit-msg.ts](https://github.com/TerrorSquad/php-booster/blob/main/booster/.husky/commit-msg.ts))

Validates commit messages and branch names:
- **Branch name validation** - Uses validate-branch-name configuration
- **Commit message linting** - CommitLint enforcement
- **Ticket footer appending** - Automatically adds ticket ID to commit messages when required

**Environment Variables:**

::field-group
  ::field{name="SKIP_COMMITMSG" type="boolean"}
  Skip entire hook
  ::
  ::field{name="GIT_HOOKS_VERBOSE" type="boolean"}
  Enable verbose logging
  ::
::

## Configuration

### Commit Message Format

CommitLint configuration is defined in [commitlint.config.ts](https://github.com/TerrorSquad/php-booster/blob/main/booster/commitlint.config.ts):

```ts
// Example: Conventional Commits format
type: 'feat|fix|chore|docs|style|refactor|perf|test'
scope: 'optional scope'
message: 'clear description'
```

### Branch Name Rules

Configure branch naming in [validate-branch-name.config.cjs](https://github.com/TerrorSquad/php-booster/blob/main/booster/validate-branch-name.config.cjs):

```js
module.exports = {
  config: {
    types: ['feat', 'fix', 'chore'],
    ticketIdPrefix: 'TICKET',
    ticketNumberPattern: '[0-9]+',
    requireTickets: true,
    commitFooterLabel: 'Closes',
  }
}
```

### Configuration File (Optional)

For project-specific customizations, create a `.git-hooks.config.json` file at your project root:

```json [.git-hooks.config.json]
{
  "$schema": "https://raw.githubusercontent.com/TerrorSquad/php-booster/main/booster/.git-hooks.config.schema.json",
  "verbose": false,
  "skip": {
    "preCommit": false,
    "prePush": false,
    "commitMsg": false,
    "tests": false,
    "artifacts": false
  },
  "tools": {
    "Psalm": { "enabled": false },
    "PHPStan": { "args": ["analyse", "--level=9"] }
  }
}
```

#### Skip Options

::field-group
  ::field{name="preCommit" type="boolean"}
  Skip entire pre-commit hook (default: false)
  ::
  ::field{name="prePush" type="boolean"}
  Skip entire pre-push hook (default: false)
  ::
  ::field{name="commitMsg" type="boolean"}
  Skip commit message validation (default: false)
  ::
  ::field{name="tests" type="boolean"}
  Skip tests during pre-push (default: false)
  ::
  ::field{name="artifacts" type="boolean"}
  Skip artifact generation during pre-push (default: false)
  ::
::

#### Tool Configuration

Disable, override, or add custom tools:

```json [Disable a tool]
{
  "tools": {
    "Psalm": { "enabled": false }
  }
}
```

::note
**Tool names are case-insensitive.** You can use `"psalm"`, `"PSALM"`, or `"Psalm"` interchangeably in your config file.
::

```json [Override arguments]
{
  "tools": {
    "PHPStan": { "args": ["analyse", "--level=9", "--memory-limit=1G"] }
  }
}
```

```json [Add custom tool]
{
  "tools": {
    "MyLinter": {
      "command": "vendor/bin/my-lint",
      "args": ["--strict"],
      "type": "php",
      "extensions": [".php"],
      "description": "Custom PHP linter"
    }
  }
}
```

::tip
Alternative config file names: `.githooks.json` or set `GIT_HOOKS_CONFIG` environment variable to a custom path.
::

## Usage

### Running Hooks Manually

::tip
While hooks run automatically, you can execute them manually:
::

```bash [Terminal]
# Pre-commit checks
./node_modules/.bin/zx ./booster/.husky/pre-commit.ts

# Pre-push checks
./node_modules/.bin/zx ./booster/.husky/pre-push.ts

# Commit message validation
./node_modules/.bin/zx ./booster/.husky/commit-msg.ts <commit-file>
```

### Skipping Hooks

::note
Use environment variables to skip specific tools or entire hooks:
::

```bash [Terminal]
# Skip ECS during commit (but run other tools)
SKIP_ECS=1 git commit -m "..."

# Skip entire pre-commit hook
SKIP_PRECOMMIT=1 git commit -m "..."

# Verbose output for debugging
GIT_HOOKS_VERBOSE=1 git commit -m "..."
```

### Persistent Skip Settings with `.git-hooks.env`

Instead of setting environment variables for each command, create a `.git-hooks.env` file at your project root:

```bash [.git-hooks.env]
# Skip specific tools
SKIP_DEPTRAC=1
SKIP_PSALM=1

# Enable verbose logging
GIT_HOOKS_VERBOSE=1

# Run only specific tool groups
HOOKS_ONLY=lint,format
```

::tip
The hook system loads environment files in this order:
1. `GIT_HOOKS_ENV_FILE` (custom path via env var)
2. `.git-hooks.env` (project root)
3. `.env` (fallback)
::

When `GIT_HOOKS_VERBOSE=1` is set, you'll see which skip variables were loaded from the env file.

### Running Specific Tool Groups

Use `HOOKS_ONLY` to run only certain categories of tools:

```bash [Terminal]
# Run only linting tools (ESLint, Stylelint, PHP Syntax Check)
HOOKS_ONLY=lint git commit -m "..."

# Run only formatting tools (Prettier, ECS)
HOOKS_ONLY=format git commit -m "..."

# Run only static analysis (PHPStan, Psalm, Deptrac)
HOOKS_ONLY=analysis git commit -m "..."

# Run multiple groups
HOOKS_ONLY=lint,format git commit -m "..."
```

**Available groups:**
| Group | Tools |
|-------|-------|
| `lint` | ESLint, Stylelint, PHP Syntax Check, TypeScript |
| `format` | Prettier, ECS |
| `analysis` | PHPStan, Psalm, Deptrac |
| `refactor` | Rector |

**Available tool names for SKIP_* variables:**
| Tool Name | Environment Variable |
|-----------|---------------------|
| ESLint | `SKIP_ESLINT` |
| Prettier | `SKIP_PRETTIER` |
| Stylelint | `SKIP_STYLELINT` |
| TypeScript | `SKIP_TYPESCRIPT` |
| PHP Syntax Check | `SKIP_PHP_SYNTAX_CHECK` |
| Rector | `SKIP_RECTOR` |
| ECS | `SKIP_ECS` |
| PHPStan | `SKIP_PHPSTAN` |
| Psalm | `SKIP_PSALM` |
| Deptrac | `SKIP_DEPTRAC` |
| Deptrac Image | `SKIP_DEPTRAC_IMAGE` |
| API Docs | `SKIP_API_DOCS` |

### DDEV Integration

If using DDEV, the `runner.sh` script automatically forwards environment variables to the container:

```bash [Terminal]
SKIP_PHPUNIT=1 SKIP_API_DOCS=1 git push
```

## Hook Implementation Details

### TypeScript with ZX

All hooks are implemented in TypeScript using [ZX](https://google.github.io/zx/), a tool for writing shell scripts in JavaScript/TypeScript:

- Type-safe implementations
- Better error handling and logging
- Shared utilities in `shared/` (exported via `shared/index.ts`)
- Consistent patterns across all hooks

### Shared Utilities

The `shared/` directory provides:
- `isSkipped(name)` - Check if a tool/hook should be skipped
- `runStep(name, action, fn)` - Execute a step with error handling and timing
- `log.*` - Consistent colored logging
- Tool execution logic with binary detection and `commandAlternatives` fallback

## Best Practices

- Use skip variables during development when you need to bypass specific checks
- Enable `GIT_HOOKS_VERBOSE=1` when troubleshooting hook issues
- Review hook output carefully before committing or pushing
- Keep hooks fast by only running on changed files
- Customize skip variables in `.env` or `.git-hooks.env` for your workflow

## Troubleshooting

### Hooks Not Running

1. Ensure hooks are installed: `npm run prepare`
2. Check hook permissions: `ls -la .git/hooks/`
3. Verify ZX installation: `npm ls zx`

### Tool Not Found

Ensure dependencies are installed:
```bash [Terminal]
composer install          # PHP tools
npm install or pnpm install  # Node tools
```

### DDEV Container Issues

Verify container is running and runner.sh has proper permissions:
```bash [Terminal]
ddev status
ls -la booster/.husky/shared/runner.sh
```

## Additional Resources

- [ZX Documentation](https://google.github.io/zx/)
- [CommitLint Documentation](https://commitlint.js.org/)
- [validate-branch-name](https://github.com/blockchain-jd-com/validate-branch-name)

::tip
* Customize hooks to match your team's workflow
* Use environment variables to adapt hooks for different scenarios
* Review and commit hook output in your PR reviews
::
